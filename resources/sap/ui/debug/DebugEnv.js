/*!
 * SAP UI development toolkit for HTML5 (SAPUI5/OpenUI5)
 * (c) Copyright 2009-2014 SAP AG or an SAP affiliate company. 
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
jQuery.sap.declare("sap.ui.debug.DebugEnv");jQuery.sap.require("sap.ui.debug.ControlTree");jQuery.sap.require("sap.ui.debug.Highlighter");jQuery.sap.require("sap.ui.debug.LogViewer");jQuery.sap.require("sap.ui.debug.PropertyList");
sap.ui.debug.DebugEnv=function(){};
sap.ui.debug.DebugEnv.prototype.startPlugin=function(c,o){this.oCore=c;this.oWindow=window;this.bRunsEmbedded=typeof window.top.testfwk=="undefined";jQuery.sap.log.info("Starting DebugEnv plugin ("+(this.bRunsEmbedded?"embedded":"testsuite")+")");if(!this.bRunsEmbedded||c.getConfiguration().getInspect()){this.init(o)}if(!this.bRunsEmbedded||c.getConfiguration().getTrace()){this.initLogger(jQuery.sap.log,o)}};
sap.ui.debug.DebugEnv.prototype.stopPlugin=function(){jQuery.sap.log.info("Stopping DebugEnv plugin.");this.oCore=null};
sap.ui.debug.DebugEnv.prototype.init=function(o){this.oControlTreeWindow=this.bRunsEmbedded?this.oWindow:(top.frames["sap-ui-ControlTreeWindow"]||top);this.oPropertyListWindow=this.bRunsEmbedded?this.oWindow:(top.frames["sap-ui-PropertyListWindow"]||top);var r=sap.ui.getCore().getConfiguration().getRTL();var c=this.oControlTreeWindow.document.getElementById("sap-ui-ControlTreeRoot"),p=this.oPropertyListWindow.document.getElementById("sap-ui-PropertyWindowRoot");if(!c){c=this.oControlTreeWindow.document.createElement("DIV");c.setAttribute("id","sap-ui-ControlTreeRoot");c.setAttribute("tabindex",-1);c.style.position="absolute";c.style.fontFamily="Arial";c.style.fontSize="8pt";c.style.backgroundColor="white";c.style.color="black";c.style.border="1px solid gray";c.style.overflow="auto";c.style.zIndex="999999";c.style.top="1px";if(r){c.style.left="1px"}else{c.style.right="1px"}c.style.height="49%";c.style.width="200px";this.oControlTreeWindow.document.body.appendChild(c)}else{c.innerHTML=""}this.oControlTreeRoot=c;if(!p){p=this.oPropertyListWindow.document.createElement("DIV");p.setAttribute("id","sap-ui-PropertyWindowRoot");p.setAttribute("tabindex",-1);p.style.position="absolute";p.style.fontFamily="Arial";p.style.fontSize="8pt";p.style.backgroundColor="white";p.style.color="black";p.style.border="1px solid gray";p.style.overflow="auto";p.style.zIndex="99999";p.style.width="196px";p.style.height="49%";if(r){p.style.left="1px"}else{p.style.right="1px"}p.style.bottom="1px";this.oPropertyListWindow.document.body.appendChild(p)}else{p.innerHTML=""}this.oPropertyWindowRoot=p;this.oControlTree=new sap.ui.debug.ControlTree(this.oCore,this.oWindow,c,this.bRunsEmbedded);this.oPropertyList=new sap.ui.debug.PropertyList(this.oCore,this.oWindow,p);this.oControlTree.attachEvent(sap.ui.debug.ControlTree.M_EVENTS.SELECT,this.oPropertyList.update,this.oPropertyList);if(!o){this.oControlTree.renderDelayed()}jQuery(window).unload(jQuery.proxy(function(e){this.oControlTree.exit();this.oPropertyList.exit()},this))};
sap.ui.debug.DebugEnv.prototype.initLogger=function(l,o){this.oLogger=l;if(!this.bRunsEmbedded){this.oTraceWindow=top.frames["sap-ui-TraceWindow"];this.oTraceViewer=this.oTraceWindow.oLogViewer=new sap.ui.debug.LogViewer(this.oTraceWindow,'sap-ui-TraceWindowRoot');this.oTraceViewer.sLogEntryClassPrefix="lvl";this.oTraceViewer.lock()}else{this.oTraceWindow=this.oWindow;this.oTraceViewer=new sap.ui.debug.LogViewer(this.oTraceWindow,'sap-ui-TraceWindowRoot')}this.oLogger.addLogListener(this.oTraceViewer);this.oCore.attachUIUpdated(this.enableLogViewer,this);if(!o){var t=this;this.oTimer=setTimeout(function(){t.enableLogViewer()},0)}};
sap.ui.debug.DebugEnv.prototype.enableLogViewer=function(){if(this.oTimer){clearTimeout(this.oTimer);this.oTimer=undefined}this.oCore.detachUIUpdated(this.enableLogViewer,this);if(this.oTraceViewer){this.oTraceViewer.unlock()}};
sap.ui.debug.DebugEnv.prototype.isRunningEmbedded=function(){return this.bRunsEmbedded};
sap.ui.debug.DebugEnv.prototype.isControlTreeShown=function(){return jQuery(this.oControlTreeRoot).css("visibility")==="visible"||jQuery(this.oControlTreeRoot).css("visibility")==="inherit"};
sap.ui.debug.DebugEnv.prototype.showControlTree=function(){if(!this.oControlTreeRoot){this.init(false)}jQuery(this.oControlTreeRoot).css("visibility","visible")};
sap.ui.debug.DebugEnv.prototype.hideControlTree=function(){jQuery(this.oControlTreeRoot).css("visibility","hidden")};
sap.ui.debug.DebugEnv.prototype.isTraceWindowShown=function(){var l=this.oTraceWindow&&this.oTraceWindow.document.getElementById('sap-ui-TraceWindowRoot');return l&&(jQuery(l).css("visibility")==="visible"||jQuery(l).css("visibility")==="inherit")};
sap.ui.debug.DebugEnv.prototype.showTraceWindow=function(){if(!this.oTraceWindow&&jQuery&&jQuery.sap&&jQuery.sap.log){this.initLogger(jQuery.sap.log,false)}var l=this.oTraceWindow&&this.oTraceWindow.document.getElementById('sap-ui-TraceWindowRoot');if(l){jQuery(l).css("visibility","visible")}};
sap.ui.debug.DebugEnv.prototype.hideTraceWindow=function(){var l=this.oTraceWindow&&this.oTraceWindow.document.getElementById('sap-ui-TraceWindowRoot');if(l){jQuery(l).css("visibility","hidden")}};
sap.ui.debug.DebugEnv.prototype.isPropertyListShown=function(){return jQuery(this.oPropertyWindowRoot).css("visibility")==="visible"||jQuery(this.oPropertyWindowRoot).css("visibility")==="inherit"};
sap.ui.debug.DebugEnv.prototype.showPropertyList=function(){if(!this.oPropertyWindowRoot){this.init(false)}jQuery(this.oPropertyWindowRoot).css("visibility","visible")};
sap.ui.debug.DebugEnv.prototype.hidePropertyList=function(){jQuery(this.oPropertyWindowRoot).css("visibility","hidden")};
(function(){var t=new sap.ui.debug.DebugEnv();sap.ui.getCore().registerPlugin(t);sap.ui.debug.DebugEnv.getInstance=jQuery.sap.getter(new sap.ui.base.Interface(t,["isRunningEmbedded","isControlTreeShown","showControlTree","hideControlTree","isTraceWindowShown","showTraceWindow","hideTraceWindow","isPropertyListShown","showPropertyList","hidePropertyList"]))}());
